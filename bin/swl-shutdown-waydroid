#!/bin/bash

# Prevent running as root
if [ "$(id -u)" -eq 0 ]; then
    echo "ERROR: Do not run this script as root. Please run as a regular user."
    exit 1
fi

if [ -z "$SWL_LOGGING_SETUP" ]; then
    source /usr/lib/swl/setup-logging.sh
    export SWL_LOGGING_SETUP=1
fi

echo "[$(date)] Starting Waydroid shutdown script..."

sudo /usr/lib/swl/reset-maxpid

# reset cage
echo "[$(date)] Resetting cage..."
cage -- bash -c 'wlr-randr'

sudo /usr/lib/swl/stop-waydroid-container

echo "[$(date)] Waydroid shutdown script completed."
