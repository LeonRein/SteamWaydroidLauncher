#!/bin/bash

# Prevent running as root
if [ "$(id -u)" -eq 0 ]; then
    echo "ERROR: Do not run this script as root. Please run as a regular user."
    exit 1
fi

source /usr/lib/swl/setup-logging.sh

echo "[$(date)] Starting Waydroid startup script..."

sudo /usr/lib/swl/start-waydroid-container

# Start the Waydroid session if not already running
if ! pgrep -f "waydroid session start" > /dev/null; then
    /usr/bin/waydroid session start & echo "[$(date)] Started waydroid session."
    sleep 1
else
    echo "[$(date)] Waydroid session already running."
fi

# Set kernel.pid_max using a separate script (optional, requires sudoers config)
sudo /usr/lib/swl/set-maxpid"

sudo /usr/lib/swl/wait-for-boot"

echo "[$(date)] Waydroid boot completed."