#!/bin/bash

# Prevent running as root
if [ "$(id -u)" -eq 0 ]; then
    echo "ERROR: Do not run this script as root. Please run as a regular user."
    exit 1
fi

if [ -z "$LOGFILE" ]; then
    source /usr/lib/swl/setup-logging.sh
fi

PACKAGE="$1"

echo "[$(date)] Starting Waydroid startup script..."

sudo /usr/lib/swl/start-waydroid-container

sudo /usr/lib/swl/set-maxpid

if [ -z "$1" ]; then
    /usr/bin/waydroid first-launch &
else
    /usr/bin/waydroid app launch "$1" &
fi

sudo /usr/lib/swl/wait-for-boot

/usr/bin/waydroid show-full-ui &

sudo /usr/lib/swl/add-controller

echo "[$(date)] Waydroid boot completed."