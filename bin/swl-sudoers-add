#!/bin/bash

SUDOERS_SRC="/usr/share/doc/swl/sudoers-template"
SUDOERS_DST="/etc/sudoers.d/99-swl"

# Prevent running as root
if [ "$(id -u)" -eq 0 ]; then
    echo "ERROR: Do not run this script as root. Please run as a regular user."
    exit 1
fi

if [ ! -f "$SUDOERS_SRC" ]; then
    echo "ERROR: Sudoers template not found at $SUDOERS_SRC"
    exit 1
fi

USERNAME="$(whoami)"
TMP_ENTRY="$(sed "s|<username>|$USERNAME|g" "$SUDOERS_SRC")"

# Only add if not already present
if sudo grep -qF "$USERNAME" "$SUDOERS_DST" 2>/dev/null; then
    echo "Sudoers entry for $USERNAME already exists in $SUDOERS_DST."
else
    echo "$TMP_ENTRY" | sudo tee -a "$SUDOERS_DST" > /dev/null
    sudo chmod 440 "$SUDOERS_DST"
    echo "Sudoers entry added to $SUDOERS_DST for user $USERNAME."
fi